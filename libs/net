
requires={
  "core",
  "fileIO"
}
listen=nil
--Main thread for incoming network connections
--Params:
--
--Returns:
--

parse=nil
--Deals with recieved messages
--params:
--received. This is the packet recieved by listen
--Returns:
--


listen=function()
  print("Listening for message")
  modem=core.getPeripheral("modem")
  if not modem.isOpen(1) then
   	modem.open(1)
  end
  while true do
    --event, modemSide, senderChannel, replyChannel, message, senderDistance  
    received = {os.pullEvent("modem_message")}
    parse(received)
  end
end

parse = function(received)
  for _,item in pairs(received) do
    print(item)
  end
  while true do
    print("Press E to exit")
    event,key=os.pullEvent("key")

    if key==keys.e then
      break
    end
  end
end
  
main=function()
  os.loadAPI("libs/i")
  i.importList(requires)
  listen()
end


main()

